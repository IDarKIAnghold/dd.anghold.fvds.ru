import{r as f,h as M,Q as c,z as N,o as p,c as _,b as x,w as S,u as k,Z as z,a as s,e as m,v as T,t as v,n as b,l as w,F as V,q as R,j,d as y,x as q,D as E}from"./app.BQx0zvW2.js";import{y as g,s as L}from"./ymaps.esm.BOWo3gvD.js";const O=s("title",null,"Оформление заказа",-1),H={class:"orders"},P={class:"row"},Q={class:"input-row__error"},Z={class:"input-row__error-message"},G=s("div",{class:"base-step-label_su9"},[s("div",{class:"number-step-label"},"1"),y(" Данные пользователя ")],-1),J={class:"userInfo div-border-style"},K={class:"personal-info-confirm-container"},W={class:"input-row"},X=s("label",{for:"ir-email",class:"input-row__label"},"Имя",-1),Y={class:"personal-info-confirm-container"},ss={class:"input-row"},es=s("label",{for:"ir-email",class:"input-row__label"},"Фамилия",-1),ts={class:"personal-info-confirm-container"},os={class:"input-row"},ns={class:"input-row__container"},as=s("label",{for:"ir-email",class:"input-row__label"},"Номер телефона",-1),ls={class:"row"},rs=s("div",{class:"base-step-label_su9"},[s("div",{class:"number-step-label"},"2"),y(" Адресс доставки ")],-1),is={class:"div-border-style"},ds={class:"personal-info-confirm-container"},us={class:"input-row"},cs=s("label",{for:"ir-email",class:"input-row__label"},"Адресс",-1),ps={key:0,class:"suggestions-list"},_s=["onClick"],ms=s("div",{class:"yandexmap",id:"yandexmap"},null,-1),fs={class:"row"},vs=s("div",{class:"base-step-label_su9"},[s("div",{class:"number-step-label"},"3"),y(" Подтверждение заказа ")],-1),bs={class:"div-border-style"},ws={class:"mb-2"},gs=s("p",null,"Оплата производиться наличными или картой курьеру при получении товара",-1),ks={__name:"order",setup(ys){const r=f(""),i=f([]),a=f(!1);let h;const n=M({first_name:c().props.user?c().props.user.first_name:null,last_name:c().props.user?c().props.user.last_name:null,phone:null,address:null});async function C(o){return await(await g.load("https://api-maps.yandex.ru/2.1/?apikey=d6414e4b-20b1-486f-af2b-1681cecc4ada&lang=ru_RU")).geocode(o).then(D=>D.geoObjects.get(0).getAddressLine())}N(async()=>{const o=await g.load("https://api-maps.yandex.ru/2.1/?apikey=d6414e4b-20b1-486f-af2b-1681cecc4ada&suggest_apikey=431b11fa-b589-4418-bd92-c204362d695f&lang=ru_RU&load=package.full");h=new o.Map("yandexmap",{center:[52.2978,104.2964],zoom:5,controls:["zoomControl"]},{restrictMapArea:[[52.222,103.49],[52.379,104.415]]}),h.events.add("click",async e=>{const t=e.get("coords"),l=await C(t);l&&(n.address=l)})});const F=async o=>(await(await g.load("https://api-maps.yandex.ru/2.1/?apikey=d6414e4b-20b1-486f-af2b-1681cecc4ada&lang=ru_RU")).suggest(o,{results:5,boundedBy:[[52.222,103.49],[52.379,104.415]]})).map(l=>l.displayName),B=async o=>{const e=o.target.value;e.length>2?(i.value=await F(e),a.value=!0):(i.value=[],a.value=!1)},I=o=>{n.address=o,a.value=!1},U=()=>{q.post(route("orderSet"),n,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{console.log(o.data),o.data.error&&(r.value=o.data.error_text,window.scrollBy(0,0)),o.data===!0&&E.put(route("orderViewDone"))}).catch(o=>{console.log("Error updating: ",o)})},d=o=>{r.value="",$(o.target).closest(".personal-info-confirm-container").find(".input-row__container").addClass("input-row__container_filled")},A=o=>{a.value=!0},u=o=>{setTimeout(()=>{a.value=!1},100),o.target.value===""&&$(o.target).closest(".personal-info-confirm-container").find(".input-row__container").removeClass("input-row__container_filled")};return(o,e)=>(p(),_(V,null,[x(k(z),null,{default:S(()=>[O]),_:1}),s("div",H,[s("div",P,[m(s("div",Q,[s("div",Z,v(r.value),1)],512),[[T,r.value!==""]]),G,s("div",J,[s("div",K,[s("div",W,[s("div",{class:b(["input-row__container",{"input-row__container_filled":n.first_name}])},[m(s("input",{type:"text",class:"input-row__input",onFocus:e[0]||(e[0]=t=>d(t)),onBlur:e[1]||(e[1]=t=>u(t)),"onUpdate:modelValue":e[2]||(e[2]=t=>n.first_name=t)},null,544),[[w,n.first_name]]),X],2)])]),s("div",Y,[s("div",ss,[s("div",{class:b(["input-row__container",{"input-row__container_filled":n.last_name}])},[m(s("input",{type:"text",class:"input-row__input",onFocus:e[3]||(e[3]=t=>d(t)),onBlur:e[4]||(e[4]=t=>u(t)),"onUpdate:modelValue":e[5]||(e[5]=t=>n.last_name=t)},null,544),[[w,n.last_name]]),es],2)])]),s("div",ts,[s("div",os,[s("div",ns,[x(k(L),{type:"tel",class:"input-row__input",onFocus:e[6]||(e[6]=t=>d(t)),onBlur:e[7]||(e[7]=t=>u(t)),modelValue:n.phone,"onUpdate:modelValue":e[8]||(e[8]=t=>n.phone=t),mask:"+7 (999) 999-99-99"},null,8,["modelValue"]),as])])])])]),s("div",ls,[rs,s("div",is,[s("div",ds,[s("div",us,[s("div",{class:b(["input-row__container",{"input-row__container_filled":n.address}])},[m(s("input",{type:"text",class:"input-row__input",id:"address-input",onFocus:e[9]||(e[9]=t=>(d(t),A())),onBlur:e[10]||(e[10]=t=>u(t)),"onUpdate:modelValue":e[11]||(e[11]=t=>n.address=t),onInput:B,autocomplete:"off"},null,544),[[w,n.address]]),cs],2)]),a.value&&i.value.length?(p(),_("ul",ps,[(p(!0),_(V,null,R(i.value,t=>(p(),_("li",{key:t,onClick:l=>I(t)},v(t),9,_s))),128))])):j("",!0)]),ms])]),s("div",fs,[vs,s("div",bs,[s("div",ws,[gs,s("p",null,"Сумма к оплате "+v(o.$page.props.totalPrice)+" рублей",1)]),s("div",null,[s("button",{type:"button",onClick:U,class:"btn btn-success text-white"},"Оформить Заказ")])])])])],64))}};export{ks as default};
